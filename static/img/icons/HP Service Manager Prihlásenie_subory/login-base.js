window.hpsm=window.hpsm||{};if(top.cwc&&top.cwc.initDebug){top.cwc.initDebug(window);}!function(){hpsm.READONLY_STYLE="FormatInputReadonly";hpsm.HIDDEN_STYLE="xHidden";hpsm.FOCUS_STYLE="xFocus";hpsm.ERROR_STYLE="xError";hpsm.EDIT_CLASS="xEdit";hpsm.SELECTED_CLASS="xSelect";hpsm.HIGHLIGHT_CLASS="highlight";hpsm.isIE=(navigator.userAgent.indexOf("MSIE")!=-1)||(navigator.userAgent.indexOf("trident")!=-1);hpsm.isIE9=navigator.userAgent.indexOf("MSIE 9.0")!=-1;hpsm.apply=function(tgt,src,override){if(override===undefined){override=true;}if(window.Ext){if(override){Ext.apply(tgt,src);}else{Ext.applyIf(tgt,src);}}else{for(var p in src){if(!src.hasOwnProperty(p)){continue;}if(!override&&tgt.hasOwnProperty(p)){continue;}tgt[p]=src[p];}}};hpsm.isFunction=function(func){if(window.Ext){return Ext.isFunction(func);}else{return typeof(func)==="function";}};hpsm.addClass=function(elem,className){if(typeof elem=="string"){elem=document.getElementById(elem);}if(!elem){return;}if(hpsm.hasClass(elem,className)){return;}if(className.substr(0,1)!=" "){className=" "+className;}elem.className=elem.className+className;};hpsm.removeClass=function(elem,className){if(typeof elem=="string"){elem=document.getElementById(elem);}if(!elem){if(cwc.jsDebug&&window.console){console.log("hpsm.removeClass failed, elem is "+elem);}return;}if(elem&&elem.className&&className){var classes=elem.className.split(/\s+/),idx=0;className=className.replace(/^\s+|\s+$/g,"");while((idx=classes.indexOf(className,idx))>-1){classes.splice(idx,1);}elem.className=classes.join(" ");}};hpsm.removeClassWithFilter=function(elem,filter){if(typeof elem=="string"){elem=document.getElementById(elem);}if(!elem){if(cwc.jsDebug&&window.console){console.log("hpsm.removeClass failed, elem is "+elem);}return;}if(elem&&elem.className){var classes=elem.className.split(/\s+/),idx=0,len=classes.length;while(idx<len){if(filter(classes[idx])){classes[idx]="";}idx++;}elem.className=classes.join(" ");}};hpsm.hasClass=function(elem,className){if(typeof elem=="string"){elem=document.getElementById(elem);}if(!elem){if(cwc.jsDebug&&window.console){console.log("hpsm.hasClass failed, elem is "+elem);}return false;}return className&&(" "+elem.className+" ").indexOf(" "+className+" ")!=-1;};hpsm.showElement=function(elem){hpsm.removeClass(elem,hpsm.HIDDEN_STYLE);};hpsm.hideElement=function(elem){hpsm.addClass(elem,hpsm.HIDDEN_STYLE);};hpsm.isVisible=function(elem){return !hpsm.hasClass(elem,hpsm.HIDDEN_STYLE)&&elem.style.display!="none";};hpsm.findObj=function(id,d){if(!d||!d.getElementById){d=document;}return d.getElementById(id);};hpsm.up=function(id,className){var p=hpsm.findObj(id),b=document.body,depth=0;if(p){p=p.parentElement;}while(p&&depth<50&&p!=b){if(hpsm.hasClass(p,className)){return p;}depth++;p=p.parentElement;}return null;};hpsm.eszetToUpperCase=function(el){if(hpsm.isIE&&(event.keyCode==219||el.value.indexOf("\xDF")!=-1)){el.value=el.value.replace(/\xDF/gi,"SS");}};hpsm.toggleElementClass=function(elem,className,flag){if(hpsm.hasClass(elem,className)^flag){flag?hpsm.addClass(elem,className):hpsm.removeClass(elem,className);}};hpsm.toggleClass=function(id,className,flag){var elem=hpsm.findObj(id);if(!elem){if(cwc.jsDebug&&window.console){console.log("not found:"+id);}return;}hpsm.toggleElementClass(elem,className,flag);};hpsm.setFocusStyle=function(id,isFocus){hpsm.toggleClass(id+"Edit",hpsm.FOCUS_STYLE,isFocus);};hpsm.setErrorStyle=function(id,isError){hpsm.toggleClass(id+"Edit",hpsm.ERROR_STYLE,isError);};hpsm.setReadonlyStyle=function(id,isReadonly){hpsm.toggleClass(id+"Edit",hpsm.READONLY_STYLE,isReadonly);};function convertCssClass(value){value=encodeURI(value);value=value.replace(/[^0-9a-zA-Z%_]/g,function(c){return"%"+c.charCodeAt(0).toString(16).toUpperCase();}).replace(/%/g,"-");return value;}hpsm.convertValueClass=function(value){if(!value||value.trim()==""){return"";}return"value_"+convertCssClass(value);};hpsm.convertFieldClass=function(fieldName,tableName){if(!fieldName||fieldName.trim()==""){return"";}fieldName=fieldName.replace(/[\s\.]/g,"_");fieldName="field_"+convertCssClass(fieldName);tableName="file_"+convertCssClass(tableName);return tableName+" "+fieldName;};hpsm.getColor=function(sCode){switch(sCode){case"0":return"black";case"1":return"red";case"2":return"green";case"3":return"blue";case"4":return"gray";case"5":return"#D3D3D3";case"6":return"#A9A9A9";case"7":return"yellow";case"8":return"cyan";case"9":return"magenta";case"10":return"white";case"11":return"#009900";case"12":return"#003399";case"13":return"#990099";case"14":return"#6699CC";case"15":return"#330000";case"16":return"#FFFFCC";}return"black";};hpsm.isInListDetailView=function(){return cwc.getActivePopup()?false:cwc.isListDetail();};hpsm.getCurrentContextWindow=function(){if(cwc.getActivePopup()){return cwc.getActivePopup().getWindow();}else{if(cwc.isListDetail()){return window.listConfig?cwc.getListWindow():cwc.getDetailWindow();}else{return cwc.getCenterWindow();}}};hpsm.getDetailWindow=function(){if(cwc.getActivePopup()){return cwc.getActivePopup().getWindow();}else{if(cwc.isListDetail()){return cwc.getDetailWindow();}else{return cwc.getCenterWindow();}}};hpsm.getListWindow=function(){if(cwc.getActivePopup()){return cwc.getActivePopup().getWindow();}else{if(cwc.isListDetail()){return cwc.getListWindow();}else{return cwc.getCenterWindow();}}};hpsm.toggleHighlight=function(elem,isHighlighted){hpsm.toggleClass(elem.id,hpsm.HIGHLIGHT_CLASS,isHighlighted);};hpsm.extractStyleNumber=function(style){try{return parseInt(style.replace("px",""));}catch(e){return 0;}};hpsm.getHeight=function(element){var height=element.style.height;if(height&&height[height.length-1]!="%"){height=hpsm.extractStyleNumber(height);}else{height=element.offsetHeight;}return height;};hpsm.setHeight=function(element,height){if(!isNaN(height)){element.style.height=height+"px";}else{element.style.height=height;}};hpsm.imgHoverStyle=function(imgElem,hover){if(imgElem==null){return;}imgElem.src=hover?imgElem.getAttribute("hover-src"):imgElem.getAttribute("normal-src");};hpsm.imgFocusStyle=function(imgElem,focus){if(imgElem==null){return;}imgElem.src=focus?imgElem.getAttribute("focus-src"):imgElem.getAttribute("normal-src");};if(!Object.create){Object.create=function(o){function F(){}F.prototype=o;return new F();};}hpsm.ns=function(ns){if(typeof ns!="string"||ns==""){throw new Error("invalid namespace..."+ns);}var scope=window;ns.split(".").forEach(function(packageName){if(packageName==""){throw new Error("invalid namespace..."+ns);}if(!scope[packageName]){scope[packageName]={};}scope=scope[packageName];});return scope;};hpsm.getWindow=function(elem){if(elem==null){return null;}var doc=elem.ownerDocument;return doc.defaultView||doc.parentWindow;};hpsm.getWidget=function(elem){if(elem==null){return null;}if(typeof elem=="string"){elem=document.getElementById(elem);}return hpsm.widgets.wrapWidget(elem);};hpsm.isElementInDom=function(elem){while(elem){if(elem==document){return true;}elem=elem.parentNode;}return false;};hpsm.removeElementFromDom=function(elem){elem&&elem.parentNode&&elem.parentNode.removeChild(elem);};hpsm.appendCSRFToken=function(params){return(params?params+"&":"")+cwc.getCSRFTokenName()+"="+cwc.getCSRFTokenValue();};hpsm.inherit=function(subClass,superClass){subClass.prototype=Object.create(superClass.prototype,{constructor:{value:subClass}});Object.defineProperties(subClass,{superClass:{value:superClass}});};hpsm.tryRun=function(fn){try{return fn();}catch(e){cwc.jsDebug&&window.console&&console.debug(e.message);}};hpsm.tryRunAsync=function(fn,callBack){setTimeout(function(){try{var ret=fn();if(callBack){callBack(ret);}}catch(e){cwc.jsDebug&&window.console&&console.debug(e.message);}},1);};}();hpsm.widgets=hpsm.widgets||{};!function(){var AbstractWidget=function(pElem,features){var self=this;if(pElem){self.id=pElem.id;self.elem=pElem;}self.features=features;if(features&&features.mandatory){self.initMandatory();}if(features&&features.popup){self.initPopup();}};hpsm.apply(AbstractWidget.prototype,{getId:function(){return this.id;},isReadonly:function(){if(!(this.features&&this.features.readonly)){return false;}throw new Error("abstract method isReadonly() for AbstractWidget");},initMandatory:function(){if(!(this.features&&this.features.mandatory)){return;}var self=this;var mandatoryElem=hpsm.findObj(self.id+"Mandatory");if(mandatoryElem){self.mandatoryElement=mandatoryElem;}else{if(self.id.indexOf("_")>-1){var tableContainer=tpz_printTemplates?hpsm.up(self.id,"TableContainer"):Ext.get(self.id).up(".TableContainer");if(tableContainer){self.mandatoryElement=hpsm.findObj(tableContainer.id+"Mandatory");}}}},setMandatory:function(value){if(!(this.features&&this.features.mandatory)){return;}var self=this;var fieldMandatory=self.mandatoryElement;if(fieldMandatory){fieldMandatory.setAttribute("mandatory",value?"1":"0");showElementMandatory(self.inputElement,value);}self.updateMandatoryInfo(value);},updateMandatoryInfo:function(value){if(!(this.features&&this.features.mandatory)){return;}var self=this;if(self.id.indexOf("Readonly")<0&&self.id.indexOf("Hidden")<0&&self.id.indexOf("Anchor")<0){var isReadonly=self.isReadonly();setMandatoryInvisibleInfo(self.inputElement.id,value&&!isReadonly);}},isMandatory:function(){if(!(this.features&&this.features.mandatory&&this.mandatoryElement)){return false;}return !(this.mandatoryElement.getAttribute("mandatory")=="0");},initPopup:function(){if(!(this.features&&this.features.popup)){return;}var self=this;self.popupDiv=hpsm.findObj(self.id+"Popup_div");},setValue:function(value){var elem=this.elem;if(String(value)!=elem.value){elem.value=value;applyToElementsWithSameDvdvar(elem,value);dvdOnChange(elem);}}});hpsm.widgets.wrapWidget=function(element,widgetType){if(!element){return null;}if((typeof element)=="string"){element=document.getElementById(element);if(!element){return null;}}if(!widgetType){var scriptType=element.getAttribute("scripttype");if(!scriptType){return null;}widgetType=widgetTypes[scriptType.toUpperCase()];}if(!widgetType||!(typeof widgetType==="function")||!(Object.create(widgetType.prototype) instanceof hpsm.widgets.AbstractWidget)){return null;}var widget=element.wrapWidget;if(widget!=null&&widget.constructor==widgetType.prototype.constructor){return widget;}widget=new widgetType(element);element.wrapWidget=widget;return widget;};var widgetTypes={};hpsm.widgets.registerWidget=function(scriptType,widgetType){widgetTypes[scriptType.toUpperCase()]=widgetType;};hpsm.widgets.AbstractWidget=AbstractWidget;}();hpsm.widgets=hpsm.widgets||{};!function(){var InputField=function(pElem,features){InputField.superClass.call(this,pElem,features);var self=this;self.inputElement=pElem;self.editDiv=hpsm.findObj(self.id+"Edit");};hpsm.inherit(InputField,hpsm.widgets.AbstractWidget);hpsm.apply(InputField.prototype,{isReadonly:function(){return this.inputElement.readOnly;}});hpsm.widgets.registerWidget("text",InputField);hpsm.widgets.InputField=InputField;}();hpsm.widgets=hpsm.widgets||{};!function(){var INPUT_LOWER="inputLower";var INPUT_CAPS="inputCaps";if(hpsm.widgets.Combo){return;}var Combo=function(pElem){Combo.superClass.call(this,pElem,{readonly:true,mandatory:true,popup:true});};hpsm.inherit(Combo,hpsm.widgets.InputField);hpsm.apply(Combo.prototype,{getDef:function(){if(!this.def){this.def=registerCombo(this.getId());}return this.def;}});hpsm.widgets.registerWidget("combo",Combo);hpsm.arCombos={};function ComboDef(id){this.id=id;}Object.defineProperties(ComboDef.prototype,{cbpopup:{get:function(){return this.getElement("popup","Popup");}},cbedit:{get:function(){return this.getElement("edit","");}},cbhidden:{get:function(){return this.getElement("hidden","Hidden");}},cbreadonly:{get:function(){return this.getElement("readonly","Readonly");}},cbreference:{get:function(){return this.getElement("reference","Reference");}},getElement:{value:function(param,idPostfix){var combo=this;if(!param||param.length==0){return null;}var privParam="_"+param;if(!combo[privParam]||!hpsm.isElementInDom(combo[privParam])){combo[privParam]=document.getElementById(combo.id+idPostfix);}return combo[privParam];}}});var StringUtils=hpsm.StringUtils;var callerWidgetId=null;var showPopupTime=null;var g_lastQuery="",g_lastMatchedQuery="",g_lastMatchedIndex=-1,g_lastAutoCompletedId="";function getOptionText(popup,index){return popup.optionsData&&popup.optionsData[index]?popup.optionsData[index]["d"]:"";}function setOptionText(optionDiv,text){if(hpsm.isIE){optionDiv.innerText=text;}else{optionDiv.textContent=text;}}function setOptionHtml(optionDiv,html){optionDiv.innerHTML=html;}function getOptionValue(popup,index){return popup.optionsData&&popup.optionsData[index]?popup.optionsData[index]["v"]:"";}function setOptionValue(optionDiv,value){optionDiv.setAttribute("value",value);}function setComboValueList(sValue,options){var popup=findComboPopup(this.id);if(popup){popup.parentNode.setAttribute("needRender","true");if(!popup.optionsData){popup.optionsData=[];}if(sValue){var displayList=this.getAttribute("dvdDisplayList");var bHasDisplayList=(displayList&&displayList!="");var ar=sValue.split(";");for(var i=0;i<ar.length;i++){var sNext=ar[i];if(popup.optionsData[i]){popup.optionsData[i]["v"]=sNext;if(!bHasDisplayList){popup.optionsData[i]["d"]=sNext;}}else{popup.optionsData.push({"v":sNext,"d":sNext});}}popup.optionsData.length=ar.length;}else{clearComboList(popup);}popup.initialOptions=popup.optionsData;}cbShowTextValue(this.id);var comboId=this.id;dvdOnChange(this,undefined,function(dep){return dep.sProp==="ValueList"&&dep.sField===comboId;});if(options&&options.cbValueUpdated){this.value="";cbTransferDataValue(this.id);}}function setComboDisplayList(sValue){var popup=findComboPopup(this.id);if(popup){popup.parentNode.setAttribute("needRender","true");if(!popup.optionsData){popup.optionsData=[];}if(sValue){var valueList=this.getAttribute("dvdValueList");var bHasValueList=(valueList&&valueList!="");var ar=sValue.split(";");for(var i=0;i<ar.length;i++){var sNext=ar[i];if(popup.optionsData[i]){popup.optionsData[i]["d"]=sNext;if(!bHasValueList){popup.optionsData[i]["v"]=sNext;}}else{popup.optionsData.push({"v":sNext,"d":sNext});}}popup.optionsData.length=ar.length;}else{clearComboList(popup);}popup.initialOptions=popup.optionsData;}}function clearComboList(popup){for(var i=popup.children.length-1;i>=0;i--){popup.removeChild(popup.children[i]);}popup.optionsData.splice(0);}function getComboValue(){var value;if(this.value){value=this.value.toLowerCase();}else{if(tpz_printTemplates){var hiddenElement=document.getElementById(this.id+"Hidden");if(hiddenElement){return hiddenElement.value;}}value=this.innerHTML.toLowerCase();}var popup=findComboPopup(this.id);if(popup&&!popup.isAutoComplete){var options=popup.optionsData||popup.children;for(var i=0,iMax=options.length;i<iMax;i++){var e=options[i];var itemValue=getOptionText(popup,i);if(itemValue.toLowerCase()==value){return getOptionValue(popup,i);}}}var readOnlyIdx=this.id.indexOf("Readonly");if(readOnlyIdx>-1){var editId=this.id.substring(0,readOnlyIdx);var combo=registerCombo(editId);if(combo&&combo.cbhidden){return combo.cbhidden.value;}}return this.value;}function setComboValue(value){var popup=findComboPopup(this.id);if(popup){var options=popup.optionsData||popup.children;var oldValue=this.value;for(var i=0,iMax=options.length;i<iMax;i++){var e=options[i];if(getOptionValue(popup,i)==value){this.value=getOptionText(popup,i);if(oldValue!=this.value){applyToElementsWithSameDvdvar(this,value);dvdOnChange(this);}return;}}}this.value=value;var readonlyEle=document.getElementById(this.id+"Readonly");if(readonlyEle){readonlyEle.value=value;}if(oldValue!=this.value){applyToElementsWithSameDvdvar(this,value);dvdOnChange(this);}}function getHiddenValue(id){var combo=hpsm.arCombos[id];if(!combo||!combo.cbhidden){return;}return combo.cbhidden.value;}function cbShow(widgetId,forDynamicForm,skipSelectMatched,inputTriggered){var combo=registerCombo(widgetId),widget;if(!combo){return;}cancelHideTask(combo);widget=combo.cbedit;widget.stopFurtherKeyHandle=true;var popupShown=cbShowPopup(widget,false,true,inputTriggered);cbAutoComplete(widget,skipSelectMatched,!popupShown);popupShown&&skipSelectMatched===undefined&&setTimeout(function(){var sVal=widget.value;if(widget.createTextRange){var rng=widget.createTextRange();var sel=rng.duplicate();sel.moveStart("character",sVal.length);sel.setEndPoint("EndToStart",rng);sel.select();}else{if(widget.setSelectionRange){widget.setSelectionRange(0,sVal.length);widget.focus();}}},1);if(hpsm.isLoginPage){widget.focus();}else{tpzOnFocus(widgetId);}}function getSelectedClass(){return hpsm.isLoginPage?"language-highlighted":hpsm.SELECTED_CLASS;}function scrollMatchedIntoView(popup){var item=getPopupListItems(popup)[popup.selectedIndex];if(!item){return;}if(hpsm.isLoginPage){document.getElementById(item.id).scrollIntoView(false);}else{var target=Ext.fly(item);target.scrollIntoView(findUpstreamPopupDiv(item));}}function renderPopup(popupDiv,forAutoComplete){if(popupDiv.getAttribute("needRender")=="true"){var popup=popupDiv.firstChild;if(!popup.getAttribute("onclick")){popup.setAttribute("onclick","hpsm.widgets.Combo.hide(this.id)");popup.setAttribute("onmouseover","hpsm.widgets.Combo.handleMouseOver(this)");popup.setAttribute("onmouseout","hpsm.widgets.Combo.handleMouseOut(this)");popup.setAttribute("onmousedown","hpsm.widgets.Combo.handleMouseDown(this, event)");popup.setAttribute("onscroll","hpsm.widgets.Combo.handleScroll(this)");}if(!forAutoComplete){popup.isAutoComplete=false;popup.innerHTML="";var items=popup.optionsData;var childDivHTMLs=[];for(var i=0;i<items.length;i++){var item=items[i];var cssClass=hpsm.isLoginPage?"language-result":("x-combo-list-item "+popupDiv.getAttribute("colorPopoupClass")+" "+(item.c||""));var optId=popup.id+"_"+(i+1);var childDivHTML=["<div",' id="',optId,'"',' index="',i,'"',' tabindex="-1"',' role="option"',' onclick="hpsm.widgets.Combo.handleOnItemClick(this, event);"'," onmouseout=\"hpsm.removeClass(this, ' x-combo-list-item-over');\""," onmouseover=\"hpsm.addClass(this, ' x-combo-list-item-over');\"",' value="',cwc.encodeHtml(item.v),'"',' class="',cssClass,'">',cwc.encodeHtml(item.d),"</div>"].join("");childDivHTMLs.push(childDivHTML);}popup.innerHTML=childDivHTMLs.join("");}else{popup.isAutoComplete=true;}popupDiv.style.backgroundColor="white";popupDiv.style.position="absolute";popupDiv.setAttribute("needRender","false");}}function cbShowPopup(widget,forAutoComplete,selectFirst,inputTriggered){var popup=findComboPopup(widget.id);var popupDiv=popup.parentNode;var combo=hpsm.arCombos[widget.id];if(inputTriggered&&g_lastQuery.length==0&&widget.value.length==0&&!combo.everPoppedUp){return false;}var matchCase=false;if(!combo.autoComplete){popup.optionsData=popup.initialOptions;popupDiv.setAttribute("needRender","true");}var sVal=widget.value;widget.oldValue=widget.value;var index=combo.autoComplete?-1:cbFindMatching(popup,sVal,matchCase);var force=isSelectOnly(widget);if(!combo.autoComplete&&force){while(index==-1&&sVal.length){sVal=sVal.substring(0,sVal.length-1);index=cbFindMatching(popup,sVal,matchCase);}}if(force&&index==-1&&widget.value.length>0){sVal=g_lastQuery;index=cbFindMatching(popup,sVal,matchCase);}g_lastMatchedIndex=index;if(index>-1&&inputTriggered){g_lastQuery=sVal;widget.value=sVal;cbFilterList(widget,popup);if(!hpsm.isLoginPage){checkLastRow(widget);}}if(widget.value.length>0&&index==-1&&inputTriggered){widget.tempValue=null;cbHide(popup.id);if(force){widget.value="";}else{if(!hpsm.isLoginPage){checkLastRow(widget);}}return false;}renderPopup(popupDiv,forAutoComplete);if(!isPopupVisible(popupDiv)){widget.oldValue=widget.value;widget.setAttribute("aria-expanded","true");popupDiv.style.zIndex=500;if(hpsm.isLoginPage){adjustPopupHeight(popup);popupDiv.style.display="block";popupDiv.style.width=(widget.offsetWidth-2)+"px";}else{var wndw=hpsm.Table.magnifyWin;if(wndw&&wndw.el.contains(widget)){popupDiv.style.zIndex=parseInt(wndw.el.getStyle("z-index"))+10;}setPopupWidthAndPosition(popup,widget);var standardPopWidth=popupDiv.style.width.replace("px","");var widgetLeft=popupDiv.style.left.replace("px","");var isMultiColumn=isMulticolumnsCombo(popup);var popupTable=popup.querySelector("table");var maxPopWidth=isMultiColumn?document.body.clientWidth*0.8:document.body.clientWidth-widgetLeft-5;var firstColumnWidth=getFirstColumnWidthForMultiColsCombo(widget);var minPopWidth=isMultiColumn&&popupTable?firstColumnWidth+80*(popupTable.rows[0].cells.length-1):standardPopWidth;var sizeKey=getStoredSizeKey(widget);var keptSize=cwc.store.session.getItem(sizeKey);if(keptSize){if(standardPopWidth<keptSize.width){popupDiv.style.width=(keptSize.width>maxPopWidth?maxPopWidth:keptSize.width)+"px";}popupDiv.style.height=keptSize.height+"px";popupDiv.firstChild.style.height="100%";}else{if(isMultiColumn){adjustPopupWidth(popup,standardPopWidth,minPopWidth,maxPopWidth);}adjustPopupHeight(popup,widget,false);}adjustPopupPosition(popup);popupDiv.style.display="block";if(!widget.resizer){widget.resizer=new Ext.Resizable(popupDiv,{handles:"se",pinned:true,transparent:false});widget.resizer.on("beforeResize",function(resizer,width,height){popupDiv.oldWidth=popupDiv.style&&popupDiv.style.width?popupDiv.style.width.replace("px",""):null;});widget.resizer.on("resize",function(resizer,width,height){popup.style.height="100%";setPopupPosition(popup,widget);adjustPopupPosition(popup);if(width>0&&height>0){cwc.store.session.setItem(sizeKey,{"width":width,"height":height});}if(isMulticolumnsCombo(popup)){var popupTable=popup.querySelector("table");if(popupTable&&popupTable.tHead){var thWidth=popupTable.tHead.rows[0].cells[0].width;if(thWidth&&popupDiv.oldWidth){popupTable.tHead.rows[0].cells[0].width=width/popupDiv.oldWidth*(thWidth.replace("px",""));}}}});}widget.resizer.minWidth=minPopWidth;widget.resizer.maxWidth=maxPopWidth;var event=new Event("dropdown",widget);sendEvent("ondropdown",event);combo.everPoppedUp=true;}callerWidgetId=widget.id;showPopupTime=new Date();}if(inputTriggered){adjustPopupHeight(popup);}if(index>-1){popup.selectedIndex=index;if(inputTriggered){popup.selectedIndex=0;}}else{if(selectFirst&&inputTriggered&&widget.value.length>0){popup.selectedIndex=0;}}if(!popup.selectedIndex){popup.selectedIndex=0;}if(popup.selectedIndex>-1&&popup.optionsData.length>0||combo.autoComplete){highlightMatched(widget,popup.selectedIndex);if(!hpsm.isLoginPage){scrollPopupDivToView(popupDiv);}}return true;}function getStoredSizeKey(widget){var widgetName=widget.name;if(widgetName.indexOf("[")>0){widgetName=widget.name.replace(/\[\d\]/g,"");}return tpz_screenName+"-"+hpsm.sCurrentForm+"-"+widgetName;}function getFirstColumnWidthForMultiColsCombo(widget){var firstColumnWidth=widget.offsetWidth+28;var maxFirstColumnWidth=160;var minFirstColumnWidth=80;if(firstColumnWidth<minFirstColumnWidth){firstColumnWidth=minFirstColumnWidth;}if(firstColumnWidth>maxFirstColumnWidth){firstColumnWidth=maxFirstColumnWidth;}return firstColumnWidth;}function setPopupWidthAndPosition(popup,widget){setPopupWidth(popup,widget);setPopupPosition(popup,widget);}function setPopupWidth(popup,widget){var popupDiv=popup.parentNode;var container=getInputContainer(widget);var standardPopWidth=container.getWidth();popupDiv.style.width=standardPopWidth+"px";}function setPopupPosition(popup,widget){var popupDiv=popup.parentNode;var container=getInputContainer(widget);var widgetLeft=container.getLeft();var widgetTop=container.getTop();var widgetHeight=container.getHeight();popupDiv.style.top=widgetTop+widgetHeight+"px";popupDiv.style.left=widgetLeft+"px";}function getInputContainer(widget){var container=Ext.get(widget.id+"Edit");if(!container){container=widget;if(container.parentNode){container=container.parentNode;if(container.parentNode){container=container.parentNode;}}}return container;}function adjustPopupWidth(popup,standardPopupWidth,minPopupWidth,maxPopupWidth){var popupDiv=popup.parentNode;if(minPopupWidth>standardPopupWidth){if(minPopupWidth<maxPopupWidth){popupDiv.style.width=minPopupWidth+"px";}else{popupDiv.style.width=maxPopupWidth+"px";}}}function adjustPopupPosition(popup){var popupDiv=popup.parentNode;var left=parseInt(popupDiv.style.left);var width=parseInt(popupDiv.style.width);var offset=left+width+10-document.body.clientWidth;if(offset>0){width-=offset;popupDiv.style.width=width+"px";}}function adjustPopupHeight(popup,widget,needCheckStore){if(needCheckStore&&cwc.store.session.getItem(getStoredSizeKey(widget))){return;}var size=popup.getAttribute("size");if(!size){size=8;}var itemHeight=24;var popupDiv=popup.parentNode;var items=getPopupListItems(popup);var itemNumberToShow=items.length>size?size:items.length;if(hpsm.isLoginPage){size=3;itemHeight=42;itemNumberToShow=items.length>size?size:items.length;}if(itemNumberToShow==0){itemNumberToShow=1;}if(popup.querySelector("thead")){itemNumberToShow++;}var height=itemNumberToShow*itemHeight+2;popupDiv.style.height=height+"px";popup.style.height="100%";}function isMulticolumnsCombo(popup){var multiColumnsAttr=popup.getAttribute("multiColumns");return multiColumnsAttr&&multiColumnsAttr=="true";}function scrollPopupDivToView(popupDiv){var frame=cwc.getCurrentTab().getDetailMIF().getFrame();var frameHeight=frame.getHeight();var popupDivBottom=Ext.fly(popupDiv).getOffsetsTo(document.body)[1]+Ext.fly(popupDiv).getHeight()+5;var scrollPosition=Ext.fly(document.body).getScroll().top;var diff=popupDivBottom-(scrollPosition+frameHeight);if(diff>0){window.scrollTo(0,scrollPosition+diff);}}function handleOnComboItemClick(item,e){var widgetId=findUpstreamPopupDiv(item).id.replace("Popup","");var popup=findComboPopup(widgetId);var index=parseInt(item.getAttribute("index"));var text=getOptionText(popup,index);if(index>-1){popup.selectedIndex=index;var combo=hpsm.arCombos[widgetId];combo.cbedit.value=text;combo.cbedit.tempValue=null;g_lastQuery=text;if(combo.autoComplete&&combo.onAutoCompleteDone){if(combo.cbreference){combo.cbreference.value=getOptionValue(popup,index);}combo.onAutoCompleteDone(combo);}}hpsm.addClass(item,getSelectedClass());}function findUpstreamPopupDiv(item){var parent=item.parentNode;while(!parent.id||parent.id.indexOf("Popup")!=parent.id.length-5){parent=parent.parentNode;}return parent;}function handleComboMouseOver(popup){popup.hasMouseOver=true;}function handleComboMouseOut(popup){clearPopupStatus(popup);}function handleComboMouseDown(popup,e){if(e.which==2){cwc.getTopCwc().ux.KeyMap.prototype.cancelEvent(e);if(window.event){cwc.getTopCwc().ux.KeyMap.prototype.cancelEvent(window.event);}return;}popup.scrollStatus="down";}function handleComboScroll(popup){popup.scrollStatus="scroll";}function onMouseOverButton(e){var target=getTarget(e),id=target.id.replace(/Button$|ButtonDiv|Combo/,""),combo=hpsm.arCombos[id];if(combo){combo.hoverOverButton=true;}}function onMouseOutButton(e){var target=getTarget(e),id=target.id.replace(/Button$|ButtonDiv|Combo/,""),combo=hpsm.arCombos[id];if(combo){combo.hoverOverButton=false;}}function getPopupListItems(popup){var table=popup.querySelector("table");var items;if(table){items=table.tBodies[0].querySelectorAll("tr");}else{items=popup.children;}return items;}function getLastPopupItem(popup){var items=getPopupListItems(popup);if(items.length>0){return items[items.length-1];}else{return null;}}function isPopupVisible(popup){return popup.style.display!="none";}function scrollIntoPopup(popup,direction){var selectedClass=getSelectedClass();if(isPopupVisible(popup)){var items=getPopupListItems(popup);if(direction==="UP"){if(popup.selectedIndex<=0){popup.selectedIndex=items.length-1;}else{popup.selectedIndex--;}}else{if(popup.selectedIndex>=items.length-1){popup.selectedIndex=0;}else{popup.selectedIndex++;}}for(var i=0;i<items.length;i++){hpsm.removeClass(items[i],selectedClass);}if(isNaN(popup.selectedIndex)){popup.selectedIndex=0;}hpsm.addClass(items[popup.selectedIndex],selectedClass);scrollMatchedIntoView(popup);}}function findComboPopup(inputId){var comboData=registerCombo(inputId);if(comboData){return comboData.cbpopup;}return null;}function isSelectOnly(widget){return widget.getAttribute("selectonly")=="1";}function cbAutoComplete(edit,skipSelectMatched,popupHideByException){if(edit.readOnly||popupHideByException){return;}var sVal=edit.value;if(sVal==""){g_lastQuery=sVal;g_lastMatchedQuery=sVal;g_lastMatchedIndex=0;return;}if(edit.defaultValue==edit.value.trim()){if(edit.value!=edit.defaultValue){edit.value=edit.defaultValue;}return;}var popup=findComboPopup(edit.id);var force=isSelectOnly(edit);if(edit.id!=g_lastAutoCompletedId){g_lastAutoCompletedId=edit.id;g_lastMatchedQuery="";}var iIndex=edit.selectionStart;if(iIndex>0){sVal=sVal.substring(0,iIndex);}var matchCase=false;var matchedIndex=cbFindMatching(popup,sVal,matchCase);if(force||matchedIndex>-1){var isFirstCharMatched=(sVal.length==0?false:cbFindMatching(popup,sVal.substring(0,1),matchCase)!=-1);while(force&&matchedIndex==-1&&sVal.length){sVal=sVal.substring(0,sVal.length-1);matchedIndex=cbFindMatching(popup,sVal,matchCase);}if(matchedIndex==-1){g_lastMatchedIndex=-1;if(!isFirstCharMatched&&g_lastQuery==null){g_lastQuery="";}if(force){g_lastMatchedIndex=cbFindMatching(popup,g_lastQuery,matchCase);matchedIndex=g_lastMatchedIndex;edit.value=g_lastQuery;g_lastMatchedQuery=g_lastQuery;sVal=g_lastQuery;}}else{g_lastMatchedIndex=matchedIndex;g_lastQuery=sVal;}if(matchedIndex>-1){var matchedText=getOptionText(popup,matchedIndex);g_lastMatchedQuery=matchedText;if(!skipSelectMatched&&force&&StringUtils.startWithNoCase(matchedText,g_lastQuery)){edit.value=matchedText;edit.tempValue=matchedText;if(hpsm.isLoginPage){updateHiddenLanguage(getOptionValue(popup,matchedIndex));}if(sVal.length!=edit.value.length){if(edit.createTextRange){var txt=edit.createTextRange();if(txt!=null){txt.moveStart("character",sVal.length);txt.moveEnd("textedit");txt.select();try{edit.focus();}catch(e){}}}else{if(edit.setSelectionRange){edit.setSelectionRange(sVal.length,edit.value.length);edit.focus();}}}}}}g_lastQuery=sVal;}function cbKeyDown(e,sId){var key=getKey(e),combo=hpsm.arCombos[sId],widget=combo.cbedit,popup=combo.cbpopup;if("comfill"==widget.getAttribute("scripttype")&&combo.autoComplete){return;}var readonly=widget.readOnly;if(!readonly&&popup){if(isPopupVisible(popup.parentNode)){if(key==KEY.UP){cbSelectNextValue(sId,false,true);}else{if(key==KEY.DOWN){cbSelectNextValue(sId,false,false);}else{if(key==KEY.ESC){widget.tempValue=null;cbHide(popup.id,false,true,true);}else{if(key==KEY.TAB){combo.tabKeyPressed=true;clearPopupStatus(popup);}}}}}else{if(key==KEY.DOWN){cbShow(sId);}}if(key==KEY.ENTER){var target=getTarget(e);if(widget.tempValue!=null&&widget.oldValue!=widget.tempValue){widget.value=widget.tempValue;g_lastQuery=widget.tempValue;widget.tempValue=null;if(hpsm.isLoginPage){updateHiddenLanguage(getOptionValue(popup,popup.selectedIndex));}if(isPopupVisible(popup.parentNode)){target.stopFurtherKeyHandle=true;cbHide(popup.id,false,true);}if(!hpsm.isLoginPage){if(lockForm()){applyDataChange(widget);}dvdOnChange(widget,{cbValueUpdated:true});applyToSameControl(widget);}}else{if(isPopupVisible(popup.parentNode)){target.stopFurtherKeyHandle=true;cbHide(popup.id,false,true);}if(hpsm.isLoginPage){submitForm();return;}}if(target&&target.onchange){target.onchange();}}}}function cbKeyUp(e,sId,sImg){var key=getKey(e);var widget=document.getElementById(sId);if(widget&&widget.getAttribute("scripttype")=="comfill"){if(hpsm.widgets.Comfill.hasReferenceValue(sId)&&key!=38&&key!=40){if(hpsm.valueOnEnter!=dvdGetFieldValue(widget)){hpsm.widgets.Comfill.clearReferenceValue(sId);hpsm.widgets.Comfill.clearValidationWarning(sId);hpsm.arCombos[sId].hasModified=true;}}else{if(widget.value!=""){hpsm.widgets.wrapComfill(sId).setThirdButtonDisabled(false);}else{hpsm.widgets.wrapComfill(sId).setThirdButtonDisabled(true);}}}if(isNormalKey(e)||key==KEY.BACKSPACE||key==KEY.SPACE){if(!g_lastMatchedQuery){g_lastMatchedQuery=g_lastQuery;}var skipSelectMatched=key==KEY.BACKSPACE||(isSelectOnly(widget)?false:true);var oldValue=skipSelectMatched?g_lastQuery:g_lastMatchedQuery;if(StringUtils.skipMatchingInput(widget,key,widget.value,oldValue)){return;}cbShow(sId,true,skipSelectMatched,true);}if(!hpsm.isLoginPage){lockFormOnValueChange(e);}}function cbFilterList(widget,popup){var value=g_lastQuery;if(!popup){return;}if(value!=""){var options=popup.initialOptions,filtered=[];for(var i=0;i<options.length;i++){var v=options[i].d;if(StringUtils.startWithNoCase(v,value)){filtered.push(options[i]);}}popup.optionsData=filtered;popup.recordsize=filtered.length;popup.parentNode.setAttribute("needRender","true");}}function highlightMatched(widget,index){var popup=findComboPopup(widget.id);popup.selectedIndex=index;var selectedClass=getSelectedClass();var items=getPopupListItems(popup);for(var i=0;i<items.length;i++){hpsm.removeClass(items[i],selectedClass);}var item=items[popup.selectedIndex];if(item){widget.setAttribute("aria-activedescendant",item.id);hpsm.addClass(item,getSelectedClass());widget.tempValue=getOptionText(popup,popup.selectedIndex);}scrollMatchedIntoView(popup);}function cbMouseOut(sId){cbAutoComplete(document.getElementById(sId));}function cbShowTextValue(sId,isPassword){var popup,edit,hidden,readonly;var comboData=registerCombo(sId);if(comboData){popup=comboData.cbpopup;edit=comboData.cbedit;hidden=comboData.cbhidden;readonly=comboData.cbreadonly;}if(popup&&edit&&hidden){var sValue=hidden.value;var displayValue=sValue;var options=popup.optionsData;if(options){for(var i=0,iMax=options.length;i<iMax;i++){if(getOptionValue(popup,i)==sValue){displayValue=getOptionText(popup,i);break;}}if(edit.nodeName=="INPUT"){if(isSelectOnly(edit)&&sValue!=edit.defaultValue){edit.value="";}else{edit.value=displayValue;}}else{if(displayValue==""){edit.innerHTML="&#160;";}else{if(isPassword){}else{var displayNode=document.createTextNode(displayValue);var clonedEdit=edit.cloneNode(false);clonedEdit.appendChild(displayNode);if(edit.parentNode){edit.parentNode.replaceChild(clonedEdit,edit);}}}}}if(readonly){readonly.value=displayValue;}}}function generatePopupOptionsData(id,values){var combo=registerCombo(id);var popup=combo.cbpopup;if(!popup){return;}popup.initialOptions=popup.optionsData=values;}function registerCombo(sId){var popup,edit,button,hidden,readonly,reference,scripttype;if(!hpsm.arCombos[sId]){var combo=new ComboDef(sId);popup=combo.cbpopup;edit=combo.cbedit;hidden=combo.cbhidden;readonly=combo.cbreadonly;reference=combo.cbreference;hpsm.arCombos[sId]=combo;if(edit&&hidden&&!hpsm.isLoginPage){scripttype=edit.getAttribute("scripttype");if(scripttype=="combo"){button=document.getElementById(sId+"ButtonDiv");}else{if(scripttype=="comfill"){button=document.getElementById(sId+"Combo");}}if(button){tpzAddEventListener(button,"mouseover",onMouseOverButton,false);tpzAddEventListener(button,"mouseout",onMouseOutButton,false);}dvdGetFieldValue(edit);if(readonly){dvdGetFieldValue(readonly);}}}if(hidden&&hidden.value){addValueToClass(sId,"",hidden.value);}return hpsm.arCombos[sId];}function appendComboPopupToBody(popupDiv){if(popupDiv){hpsm.removeElementFromDom(popupDiv);document.body.appendChild(popupDiv);}}function cbShowDataValues(){for(var id in hpsm.arCombos){var combo=hpsm.arCombos[id];var edit=combo.cbedit;var hidden=combo.cbhidden;if(!edit||!hidden){continue;}if(isVisible(edit)&&combo.cbpopup){cbTransferDataValue(id);}else{edit.value=hidden.value;}hidden.name=edit.name?edit.name:edit.getAttribute("name");edit.removeAttribute("name");}}function cbRestoreComboName(){for(var id in hpsm.arCombos){var combo=hpsm.arCombos[id];var edit=combo.cbedit;var hidden=combo.cbhidden;if(!edit||!hidden){continue;}edit.setAttribute("name",hidden.getAttribute("name"));hidden.removeAttribute("name");}}function cbTransferDataValue(id){var matched=false;var combo=hpsm.arCombos[id];if(!combo||!combo.cbedit||!combo.cbhidden){return;}var valueSet=false;var popup=combo.cbpopup;var edit=combo.cbedit;var hidden=combo.cbhidden;var oldValue=hidden.value;var sText=edit.value;var pText;if(sText!=""&&popup&&!popup.isAutoComplete&&popup.optionsData){var options=popup.optionsData;for(var i=0,iMaxOps=options.length;i<iMaxOps;i++){pText=getOptionText(popup,i);if(hpsm.hasClass(edit,INPUT_LOWER)){pText=pText.toLowerCase();sText=sText.toLowerCase();}else{if(hpsm.hasClass(edit,INPUT_CAPS)){pText=pText.toUpperCase();sText=sText.toUpperCase();}}if(pText==sText){hidden.value=getOptionValue(popup,i);matched=true;valueSet=true;break;}}}if(!valueSet&&!isSelectOnly(edit)){hidden.value=edit.value;valueSet=true;}if(!valueSet&&edit.value==""){hidden.value="";}var newValue=hidden.value;if(newValue!=oldValue){addValueToClass(id,oldValue,newValue);}return matched;}function cbIsValueInOptions(id){var matched=false;var combo=hpsm.arCombos[id];if(!combo||!combo.cbedit){return false;}var popup=combo.cbpopup;var edit=combo.cbedit;var sText=edit.value;var pText;if(sText!=""&&popup&&!popup.isAutoComplete&&popup.optionsData){var options=popup.optionsData;for(var i=0,iMaxOps=options.length;i<iMaxOps;i++){pText=getOptionText(popup,i);if(hpsm.hasClass(edit,INPUT_LOWER)){pText=pText.toLowerCase();sText=sText.toLowerCase();}else{if(hpsm.hasClass(edit,INPUT_CAPS)){pText=pText.toUpperCase();sText=sText.toUpperCase();}}if(pText==sText){matched=true;break;}}}return matched;}function cbFindMatching(popup,sVal,bMatchCase){var i,iMax,sBuf;if(sVal==""||!popup){return -1;}var prefixMatch=-1;var options=popup.optionsData;for(i=0,iMax=options.length;i<iMax;i++){sBuf=getOptionText(popup,i);if(sBuf==sVal){return i;}if(prefixMatch==-1&&(StringUtils.startWith(sBuf,sVal)||(!bMatchCase&&StringUtils.startWithNoCase(sBuf,sVal)))){prefixMatch=i;}}return prefixMatch;}function cbSelectNextValue(sId,bMatchCase,bUp,skipSelectMatched){var popup=findComboPopup(sId);var options=popup.optionsData;if(options.length==0){return;}var edit=document.getElementById(sId);var sVal=edit.value==edit.tempValue?edit.value:edit.tempValue;if(sVal==""){sVal=getOptionText(popup,0);if(sVal.trim()==""){if(bUp){if(popup.selectedIndex<=0){return;}sVal=getOptionText(popup,options.length-1);}else{if(popup.selectedIndex>=options.length-1){return;}if(options[1]){sVal=getOptionText(popup,1);}}}}else{var iIndex=cbFindMatching(popup,sVal,bMatchCase);if(iIndex>-1){if(sVal==getOptionText(popup,iIndex)){if(bUp){if(iIndex==0){return;}else{iIndex--;}}else{if(iIndex==options.length-1){return;}else{iIndex++;}}}sVal=getOptionText(popup,iIndex);}}if(bUp){scrollIntoPopup(popup,"UP");}else{scrollIntoPopup(popup,"DOWN");}edit.setAttribute("aria-activedescendant",getPopupListItems(popup)[popup.selectedIndex].id);edit.tempValue=sVal;if(!skipSelectMatched){edit.select();}var matched=cbTransferDataValue(sId);if(matched&&edit.getAttribute("scripttype")=="comfill"){if(hpsm.widgets.Comfill.hasReferenceValue(sId)){hpsm.widgets.Comfill.setReferenceByHiddenValue(edit);}else{hpsm.widgets.wrapComfill(sId).setThirdButtonDisabled(false);}}}function showComboxDropDownButton(target){if(!target){return;}var button=document.getElementById(target.id+"ButtonDiv");if(button&&target.getAttribute("scripttype")=="combo"&&target.getAttribute("inTable")=="inTable"){var fieldDiv=getFieldDiv(target);fieldDiv.style.marginRight="32px";button.style.display="inline";}}function togglePopup(targetId,force){var target=document.getElementById(targetId);if(!target){return;}if(force||target.getAttribute("role")=="combobox"&&isSelectOnly(target)){var popup=findComboPopup(targetId);var popupDiv=popup.parentNode;if(!isPopupVisible(popupDiv)){cbShow(targetId);}else{cbHide(popup.id);}}}function handleOnInputClick(target,e){showComboxDropDownButton(target);if(isClickInside(target,e)){togglePopup(target.id);}}function isClickInside(target,e){var r=target.getBoundingClientRect(),e=e&&!cwc.isIE8?e:window.event,x=e.clientX,y=e.clientY;return x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom;}function cbOnFocus(target,event){var handled=true;if(hpsm.isLoginPage){hpsm.setFocusStyle(target.id,true);}else{hpsm.valueOnEnter=dvdGetFieldValue(target);if(target.defaultValue!=target.value){target.defaultValue=target.value;}hpsm.widgets.Comfill.triggerFillDataChange(target);hpsm.widgets.Combo.showDropDownButton(target);handled=handleOnFocus(target,event);var popup=findComboPopup(target.id);if(target.getAttribute("role")=="combobox"&&popup&&popup.parentNode){target.setAttribute("aria-activedescendant",popup.parentNode.id);}}g_lastQuery=target.value;return handled;}function handleValueChanged(target,event){var sId=target.id;var isFieldChanged=hpsm.valueOnEnter!=null&&hpsm.valueOnEnter!=dvdGetFieldValue(target);if(isFieldChanged||hpsm.widgets.Comfill.isComfillValueChanged(target)||hpsm.arCombos[target.id].updatedByAutocomplete){hpsm.valueOnEnter=null;if(target.getAttribute("scripttype")=="comfill"){if(!hpsm.arCombos[target.id].isAutoCompleteItemClicked&&!cbIsValueInOptions(sId)&&isFieldChanged){if(hpsm.widgets.Comfill.hasReferenceValue(sId)){hpsm.widgets.Comfill.clearReferenceValue(sId);hpsm.widgets.Comfill.clearValidationWarning(sId);}autoFillDisplayName(target);}hpsm.arCombos[sId].hasModified=false;hpsm.widgets.Comfill.storeComfillState(target);hpsm.widgets.Comfill.handleComfillOnChange(target,event);delete hpsm.arCombos[sId].isAutoCompleteItemClicked;delete hpsm.arCombos[sId].updatedByAutocomplete;checkLastRow(target);}else{handleOnChange(target,event);}}else{if(hpsm.arCombos[sId].hasModified&&target.value&&hpsm.widgets.Comfill.isReferenceValueEmpty(sId)){if(!hpsm.arCombos[sId].isAutoCompleteItemClicked&&!cbIsValueInOptions(sId)){autoFillDisplayName(target);}else{if(popup.recordsize==0){hpsm.widgets.Comfill.showValidationWarning(sId);}else{hpsm.widgets.Comfill.setReferenceByHiddenValue(target);}}hpsm.arCombos[sId].hasModified=false;delete hpsm.arCombos[sId].isAutoCompleteItemClicked;}}}function cbOnBlur(target,event){var sId=target.id,combo=hpsm.arCombos[sId],widget=combo.cbedit,popup=combo.cbpopup;hpsm.setFocusStyle(sId,false);if(combo.autoComplete&&!popup.hasMouseOver){combo.cfSentModel=false;while(popup.lastChild){popup.removeChild(popup.lastChild);}popup.recordsize=0;widget.lastSearchValue="";removeComboARIA(widget);popup.parentNode.style.display="none";popup.optionsData=[];clearPopupStatus(popup);}if(popup){if(popup.optionsData&&popup.optionsData.length>0&&!combo.autoComplete){cbAutoComplete(widget,!isSelectOnly(widget));}var popupId=sId+"Popup";if(combo.tabKeyPressed||!(popup.hasMouseOver||combo.hoverOverButton&&isPopupVisible(popup.parentNode))){cbHide(popupId);if(!hpsm.isLoginPage){handleValueChanged(target,event);}}else{cbHide(popupId,combo.autoComplete,false,false,combo.hoverOverButton?300:100);}}else{if(!hpsm.isLoginPage){handleValueChanged(target,event);}}}function autoFillDisplayName(widget){if(widget&&widget.value&&hpsm.widgets.Comfill.isReferenceValueEmpty(widget.id)){if(widget.value.length>=cwc.getTopCwc().autoCompleteMinChars){hpsm.arCombos[widget.id].cfSentModel=false;hpsm.widgets.Comfill.checkDisplayNameUnique(widget);}else{hpsm.widgets.Comfill.showValidationWarning(widget.id);}}}function addValueToClass(id,oldValue,newValue){var editElem=hpsm.findObj(id+"Edit");if(editElem){var valueClass=hpsm.convertValueClass(oldValue);hpsm.removeClass(editElem,valueClass);valueClass=hpsm.convertValueClass(newValue);hpsm.addClass(editElem,valueClass);}}function cbHide(popupId,silentHide,skipSelectMatched,ignoreSelectionChange,delay){var index=popupId.lastIndexOf("Popup");if(index==-1){return;}if(showPopupTime==null){return;}var displayedTime=(new Date()).getTime()-showPopupTime.getTime();if(!ignoreSelectionChange&&displayedTime<250){return;}var widgetId=popupId.substring(0,index);var combo=hpsm.arCombos[widgetId.lastIndexOf("_")>-1?callerWidgetId:widgetId];if(delay>0){createHideTask(combo,silentHide,ignoreSelectionChange,delay);}else{cancelHideTask(combo);hidePopup(combo,silentHide,ignoreSelectionChange);}}function hidePopup(combo,silentHide,ignoreSelectionChange,delayed){var widget=combo.cbedit,popup=combo.cbpopup,popupDiv=popup.parentNode;if(isPopupVisible(popupDiv)){if(delayed&&popup.hasMouseOver&&(popup.scrollStatus=="down"||popup.scrollStatus=="scroll")){widget.focus();return;}popupDiv.style.display="none";var options=getPopupListItems(popup);if(options.length>0){if(popup.selectedIndex>-1&&options[popup.selectedIndex].getAttribute("value")!=null&&!silentHide){if(combo.autoComplete&&combo.onAutoCompleteDone){if(combo.cbreference){combo.cbreference.value=getOptionValue(popup,popup.selectedIndex);}widget.value=widget.tempValue;combo.onAutoCompleteDone(combo);}if(!hpsm.isLoginPage&&!ignoreSelectionChange&&widget.value!=""&&widget.value!=widget.oldValue){if(lockForm()){applyDataChange(widget);}dvdOnChange(widget,{cbValueUpdated:true});applyToSameControl(widget);}}!combo.tabKeyPressed&&widget.focus();combo.tabKeyPressed=false;clearPopupStatus(popup);}if(combo.autoComplete==true){removeComboARIA(widget);}else{widget.setAttribute("aria-activedescendant",popupDiv.id);widget.setAttribute("aria-expanded","false");}if(!silentHide&&delayed&&!hpsm.isLoginPage){handleValueChanged(widget);}}}function createHideTask(combo,silent,ignoreSelectionChange,delay){var task=combo.hideTask;if(!task){combo.hideTask=task={fn:function(){window.clearTimeout(task.id);task.id=null;hidePopup(combo,task.silent,task.ignoreSelectionChange,true);}};}task.silent=silent;task.ignoreSelectionChange=ignoreSelectionChange;task.id&&window.clearTimeout(task.id);task.id=window.setTimeout(task.fn,delay);}function cancelHideTask(combo){var task=combo.hideTask;if(task&&task.id){window.clearTimeout(task.id);task.id=null;}}function clearPopupStatus(popup){popup.hasMouseOver=false;popup.scrollStatus="";}function resetCombo(inputId){var button=document.getElementById(inputId+"ButtonDiv");if(button){button.style.display="none";document.getElementById(inputId).parentNode.style.marginRight="0px";}var edit=document.getElementById(inputId+"Edit");if(edit){hpsm.removeClass(edit,"xFocus");}var popup=document.getElementById(inputId+"Popup");var items=getPopupListItems(popup);if(popup){for(var i=0;i<items.length;i++){hpsm.removeClass(items[i],"x-combo-list-item-over");hpsm.removeClass(items[i],"xSelect");}}var inputField=document.getElementById(inputId);if(inputField&&inputField.getAttribute("scripttype")=="comfill"){hpsm.widgets.wrapComfill(inputId).setThirdButtonDisabled(true);}}function setComboARIA(widget){widget.setAttribute("aria-autocomplete","list");widget.setAttribute("aria-activedescendant",widget.id+"Popup_div");widget.setAttribute("role","combobox");widget.setAttribute("aria-owns",widget.id+"Popup_div");widget.setAttribute("aria-haspopup","true");widget.setAttribute("aria-expanded","false");}function removeComboARIA(widget){widget.removeAttribute("aria-autocomplete");widget.removeAttribute("aria-activedescendant");widget.removeAttribute("role");widget.removeAttribute("aria-owns");widget.removeAttribute("aria-haspopup");widget.removeAttribute("aria-expanded");}if(hpsm.registerInit){hpsm.registerInit({name:"combo",fn:function(){g_lastQuery="";g_lastMatchedQuery="";g_lastMatchedIndex=-1;g_lastAutoCompletedId="";Object.keys(hpsm.arCombos).forEach(function(key){var arCombo=hpsm.arCombos[key];var popup=arCombo.cbpopup;if(popup){appendComboPopupToBody(popup.parentNode);}});}});hpsm.registerDestroy({name:"combo",fn:function(){cwc.jsDebug&&window.console&&console.debug("cleanup hpsm.arCombos");Object.keys(hpsm.arCombos).forEach(function(key){var arCombo=hpsm.arCombos[key];if(arCombo.blurTimerId){clearTimeout(arCombo.blurTimerId);}try{var edit=arCombo.cbedit;if(edit&&edit.resizer){edit.resizer.destroy();}if(edit){edit.onblur=null;}delete hpsm.arCombos[key];var popup=arCombo.cbpopup;if(popup){var popupCnt=arCombo.cbpopup.parentNode;if(popupCnt){hpsm.removeElementFromDom(popupCnt);}}}catch(e){cwc.jsDebug&&window.console&&console.debug("destroy combo no success, seems window is destroied");}});}});hpsm.registerSubmit({name:"combo",fn:cbShowDataValues});}hpsm.apply(Combo,{setValueList:setComboValueList,setDisplayList:setComboDisplayList,getValue:getComboValue,setValue:setComboValue,show:cbShow,hide:cbHide,showPopup:cbShowPopup,findPopup:findComboPopup,findMatching:cbFindMatching,handleOnItemClick:handleOnComboItemClick,handleOnFocus:cbOnFocus,handleOnBlur:cbOnBlur,handleMouseOver:handleComboMouseOver,handleMouseOut:handleComboMouseOut,handleMouseDown:handleComboMouseDown,handleScroll:handleComboScroll,setPopupWidthAndPosition:setPopupWidthAndPosition,adjustPopupHeight:adjustPopupHeight,getPopupListItems:getPopupListItems,getLastPopupItem:getLastPopupItem,getFirstColumnWidth:getFirstColumnWidthForMultiColsCombo,scrollIntoPopup:scrollIntoPopup,keyDown:cbKeyDown,keyUp:cbKeyUp,register:registerCombo,generatePopupOptionsData:generatePopupOptionsData,renderPopup:renderPopup,showDataValues:cbShowDataValues,restoreComboName:cbRestoreComboName,transferDataValue:cbTransferDataValue,showDropDownButton:showComboxDropDownButton,cbShowTextValue:cbShowTextValue,resetCombo:resetCombo,setComboARIA:setComboARIA,removeComboARIA:removeComboARIA,getOptionText:getOptionText,handleOnInputClick:handleOnInputClick,togglePopup:togglePopup,getHiddenValue:getHiddenValue});hpsm.widgets.Combo=Combo;}();window.cwc=window.cwc||{};hpsm.arCombos=hpsm.arCombos||{};hpsm.isLoginPage=true;function isIE8(){return hpsm.isIE&&document.documentMode==8;}function isIE10(){return hpsm.isIE&&document.documentMode==10;}cwc.isIE8=isIE8();cwc.isIE10=isIE10();String.prototype.trim=function(){var re=/^\s+|\s+$/g;return function(){return this.replace(re,"");};}();if(!Array.indexOf){Array.prototype.indexOf=function(obj){for(var i=0;i<this.length;i++){if(this[i]==obj){return i;}}return -1;};}function getSelectionIndex(){var children=document.getElementById("selectedLanguagePopup").children,i=0,l=children.length;for(;i<l;i++){if(hpsm.hasClass(children[i],"language-highlighted")){return i;}}return -1;}function getTarget(evt){evt=evt||window.event;var targetElement=evt.target||evt.srcElement;return targetElement;}function resize(){var btn=document.getElementById("loginBtn");var top=getElementTop(btn);var footer=document.getElementById("footer");var totalHeight=getViewport().height;footer.style.height=(totalHeight-top-btn.offsetHeight/2)+"px";footer.style.marginTop=-(totalHeight-top-btn.offsetHeight/2)+"px";}function getViewport(){if(document.compatMode=="BackCompat"){return{width:document.body.scrollWidth,height:document.body.scrollHeight};}else{return{width:document.documentElement.scrollWidth,height:document.documentElement.scrollHeight};}}function getElementTop(element){var actualTop=element.offsetTop;var current=element.offsetParent;while(current!==null){actualTop+=current.offsetTop;current=current.offsetParent;}return actualTop;}function registerEvent(){var userName=document.getElementById("LoginUsername");var password=document.getElementById("LoginPassword");var loginBtn=document.getElementById("loginBtn");var preservedUserNameValue="";userName.onkeypress=function(e){if(!isFunctionKey(e)){this.parentNode.children[0].style.display="none";}};password.onkeypress=function(e){if(!isFunctionKey(e)){this.parentNode.children[0].style.display="none";}};userName.onpaste=function(){this.parentNode.children[0].style.display="none";};password.onpaste=function(){this.parentNode.children[0].style.display="none";};userName.onkeydown=function(){preservedUserNameValue=userName.value;};userName.onkeyup=function(e){handlePlaceHolder(userName);};password.onkeyup=function(e){handlePlaceHolder(password);};loginBtn.onclick=function(){submitForm();};}function isEnterKey(e){e=e||window.event;var kcode=(e.keyCode)?e.keyCode:e.which;return kcode==KEY.ENTER;}function isFunctionKey(e){e=e||window.event;var kcode=(e.keyCode)?e.keyCode:e.which;for(var key in KEY){if(kcode===KEY[key]){return true;}}return false;}function handlePlaceHolder(input){if(input.value){input.parentNode.children[0].style.display="none";}else{input.parentNode.children[0].style.display="block";}}function isHighContrastMode(){var div=document.createElement("div"),isHighContrastMode=false;div.style.cssText="width:0px;height:0px;position:absolute;left:-10000px;border: 1px solid;border-color: red blue;";document.body.appendChild(div);if(window.getComputedStyle){var cs=window.getComputedStyle(div,null);if(cs.getPropertyValue("border-top-color")==cs.getPropertyValue("border-right-color")){isHighContrastMode=true;}}else{if(div.currentStyle["borderTopColor"]==div.currentStyle["borderRightColor"]){isHighContrastMode=true;}}document.body.removeChild(div);return isHighContrastMode;}function getKey(e){if(e&&e.keyCode){return e.keyCode;}else{if(window.event){return window.event.keyCode;}else{return e.which;}}}function isNormalKey(e){var key=getKey(e);var ignore=(key<41)||((key>=112)&&(key<=123));ignore|=(key==44)||(key==45)||(key==46)||(key==144)||(key==145);if(cwc.isGecko){ignore|=e.altKey||e.ctrlKey;}else{if(window.event){ignore|=window.event.altKey||window.event.ctrlKey;}}return !ignore;}function submitForm(){document.getElementById("loginBtn").disabled=true;var password=document.getElementById("LoginPassword").value;document.getElementById("old.password").value=password;var loginForm=document.getElementById("Login");if(window.external&&("AutoCompleteSaveForm" in window.external)){window.external.AutoCompleteSaveForm(loginForm);}loginForm.submit();}function updateHiddenLanguage(value){document.getElementById("LoginLanguage").value=value;}function prepareFormData(){document.getElementById("loginBtn").disabled=true;var password=document.getElementById("LoginPassword").value;document.getElementById("old.password").value=password;}function loginFormOnLoad(){var langPopup=hpsm.widgets.Combo.findPopup("selectedLanguage");if(langPopup.optionsData.length==0){langPopup.optionsData=[{v:"en",d:"English"}];var msgDiv=document.getElementById("WarningMsgWrapperDiv");if(msgDiv.innerHTML.length==0){msgDiv.innerHTML="<%=SERVER_NO_AVAILIABLE%>";}msgDiv.style.visible="visible";}document.getElementById("LoginUsername").focus();resize();}